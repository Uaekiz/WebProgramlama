@model webApplication.Models.Hall

@{
    var reservations = ViewBag.Reservations as List<webApplication.Models.Reservation>;
    DateTime? selectedStart = ViewBag.SelectedStart;
    DateTime? selectedEnd = ViewBag.SelectedEnd;
    bool filterApplied = ViewBag.FilterApplied ?? false;
}

<style>
   .seat-grid {
    display: grid;
    grid-template-columns: repeat(5, 70px);   /* koltuklar küçüldü */
    gap: 18px;                                /* aralar daha sıkı */
    justify-content: center;
    margin-top: 30px;
}

    .seat {
    width: 50px;                 /* Daha küçük */
    height: 50px;                /* Daha ince uzun */
    border-radius: 18px;
    padding-top: 18px;
    font-size: 20px;

    background: linear-gradient(#4caf50, #2e8b57);
    position: relative;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;

    box-shadow: 0px 4px 8px rgba(0,0,0,0.35);
    transition: transform 0.2s ease;
}


.seat::before {
    content: "";
    position: absolute;
    top: -10px;
    width: 45px;
    height: 18px;
    border-radius: 10px;
    background: inherit;
    box-shadow: 0px 3px 5px rgba(0,0,0,0.30);
}

  .seat::after {
    content: "";
    position: absolute;
    bottom: -10px;
    width: 60%;
    height: 8px;
    background: rgba(0,0,0,0.35);
    border-radius: 50%;
    filter: blur(3px);
}  



    .seat:hover {
        transform: scale(1.08);
    }

    .seat.available {
        background: linear-gradient(145deg, #34d977, #25a85c);
    }

    .seat.available:hover {
        transform: translateY(-6px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.30);
    }

    .seat.reserved {
        background: linear-gradient(145deg, #e74c3c, #b63728);
        cursor: not-allowed;
    }
   .table-row {
    grid-column: 1 / -1;           /* tüm satırı kaplasın */
    height: 45px;                  /* daha kalın masa */
    background: linear-gradient(#dcdcdc, #bfbfbf);
    border-radius: 8px;
    margin: 12px 0 22px 0;

    box-shadow:
        inset 0 2px 4px rgba(255,255,255,0.5),
        inset 0 -3px 6px rgba(0,0,0,0.25),
        0 4px 10px rgba(0,0,0,0.25);    /* gerçek masa efekti */
}

    .info-box {
        background: #d9eaff;
        padding: 15px;
        border-radius: 10px;
        border-left: 5px solid #007bff;
        font-size: 16px;
        margin-bottom: 20px;
    }
    
</style>

<h2>@Model.Name</h2>

<p>Koltuk sayısı: @Model.SeatCount</p>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success" style="font-size:16px; padding:12px;">
        @TempData["SuccessMessage"]
    </div>

    @* Başarılı rezervasyon sonrası form + koltuklar gösterilmesin *@
    return;
}


@if (!filterApplied)
{
    <div class="info-box">
        Lütfen rezervasyon yapmak istediğiniz 
        <strong>tarih</strong> ve <strong>saat </strong> aralığını seçin. Ardından boş (yeşil)
         koltuklara tıklayarak seçim yapabilirsiniz.

    </div>
}

<form method="get" style="margin-bottom:20px;">
    <input type="hidden" name="id" value="@Model.Id" />

   <div class="form-group">
    <label>Tarih seçiniz</label>
    <select name="date" class="form-control">
        <option value="@DateTime.Today.ToString("yyyy-MM-dd")">
           Bugün (@DateTime.Today.ToString("dd.MM.yyyy"))
        </option>

        <option value="@DateTime.Today.AddDays(1).ToString("yyyy-MM-dd")">
            Yarın (@DateTime.Today.AddDays(1).ToString("dd.MM.yyyy"))
        </option>
    </select>
</div>

    <div class="form-group" style="margin-top:10px;">
        <label>Başlangıç saati</label>
        <input type="time" id="startTime" name="startTime" class="form-control"
            value="@(filterApplied? selectedStart?.ToString("HH:mm") : "")" required />
    </div>

    <div class="form-group" style="margin-top:10px;">
        <label>Bitiş saati</label>
        <input type="time" id="endTime" name="endTime" class="form-control"
            value="@(filterApplied? selectedEnd?.ToString("HH:mm") : "")" required readonly />
    </div>

    <button class="btn btn-primary mt-2">Filtrele</button>
</form>

<hr />

@if (filterApplied)
{
    <div class="seat-grid">
        @{
            int index = 0;
        }

        @foreach (var seat in Model.Seats)
        {
            index++;

            bool isReserved = false;

            if (selectedStart.HasValue && selectedEnd.HasValue)
            {
                isReserved = reservations.Any(r =>
                    r.SeatId == seat.Id &&
                    r.StartTime < selectedEnd &&
                    r.EndTime > selectedStart
                );
            }

            string cssClass = isReserved ? "seat reserved" : "seat available";
            string message = isReserved ? "Bu saat aralığında dolu" : "Rezerve etmek için tıklayın";

            <div class="@cssClass" title="@message"
                 onclick="@(isReserved ? "" :
                     $"window.location='/Reservation/Create?seatId={seat.Id}&date={selectedStart?.ToString("yyyy-MM-dd")}&startTime={selectedStart?.ToString("HH:mm")}&endTime={selectedEnd?.ToString("HH:mm")}'")">
                @seat.SeatNumber
            </div>

            <!-- Her 5 koltuktan sonra masa -->
            @if (index % 5 == 0)
            {
                <div class="table-row"></div>
            }
        }
    </div>
}



@section Scripts {
    <script>
        document.getElementById("startTime").addEventListener("change", function () {
            let start = this.value;

            if (start) {
                let [hours, minutes] = start.split(":");
                hours = parseInt(hours) + 1;
                if (hours === 24) hours = 0;

                document.getElementById("endTime").value =
                    hours.toString().padStart(2, '0') + ":" + minutes;
            }
        });
    </script>
}